#!/usr/bin/env python

''' This is a simple version of a script that executes the Data Reduction Pipeline
    from the same folder as the images. The final goal is to have a script 
    connected to Yerkes' File Manager server that will automatically execute 
    whenever new images are uploaded, or on a set time interval (whichever is 
    more practical).
'''

import os
import sys
import logging

# Set logging format
logging.basicConfig(level = logging.INFO)

# Change directory & import the pipeline settings
sys.path.append('/data/scripts/DataReduction/source/')
from drp.pipeline import PipeLine

def execute():
    # Call the pipeline configuration
    pipe = PipeLine(config = '/data/scripts/DataReduction/pipeconf_master_edit_auto.txt')
    # Use the files entered as arguments in the command line.
    # Converting the arguments to strings ensures the pipeline will run even if 
    # ""s aren't entered around the file names. Just to be extra helpful
    # Allow for use with only one or two FITS files (won't result in normal color)
    if len(sys.argv) == 2:
	result = pipe([str(sys.argv[1]), str(sys.argv[1]), str(sys.argv[1])])
    elif len(sys.argv) == 3:
	result = pipe([str(sys.argv[1]), str(sys.argv[2]), str(sys.argv[2])])
    # This is the code for 3 files (i.e. the optimal path for the pipeline)
    elif len(sys.argv) == 4:
	result = pipe([str(sys.argv[1]), str(sys.argv[2]), str(sys.argv[3])])
    else:
	print "***ERROR: Number of input files is invalid. Only input 1-3 files***"

execute()

''' HISTORY '''

''' 2014/07/29: Original script created by Neil Stilin. Only used in local folder.
    2014/08/07: Added code to allow for use with only one or two FITS files -NS
'''
